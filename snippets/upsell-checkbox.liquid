{% comment %}
  Upsell Checkbox Snippet
  Zeigt Checkboxen fuer passende Zusatzprodukte an, basierend auf dem Metafeld product.metafields.custom.related_accessory (Liste)

  Verwendung: {% render 'upsell-checkbox', product: product %}
{% endcomment %}

{%- liquid
  assign related_products = product.metafields.custom.related_accessory.value
-%}

{% if related_products != blank and related_products.size > 0 %}
  <div class="upsell-checkboxes" data-upsell-container>
    {% for related_product in related_products %}
      {% if related_product.available %}
        {%- assign upsell_variant = related_product.first_available_variant -%}

        <div class="upsell-checkbox">
          <label class="upsell-checkbox__label">
            <input
              type="checkbox"
              class="upsell-checkbox__input"
              data-upsell-checkbox
              data-upsell-variant-id="{{ upsell_variant.id }}"
            >
            <span class="upsell-checkbox__checkmark">
              <svg width="12" height="10" viewBox="0 0 12 10" fill="none">
                <path d="M1 5L4 8L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>
            <span class="upsell-checkbox__content">
              {% if related_product.featured_image %}
                <span class="upsell-checkbox__image">
                  <img
                    src="{{ related_product.featured_image | image_url: width: 100 }}"
                    alt="{{ related_product.title | escape }}"
                    width="50"
                    height="50"
                    loading="lazy"
                  >
                </span>
              {% endif %}
              <span class="upsell-checkbox__text">
                <span class="upsell-checkbox__title">Dazu passend: {{ related_product.title }}</span>
                <span class="upsell-checkbox__price">(+ {{ upsell_variant.price | money }})</span>
              </span>
            </span>
          </label>
        </div>
      {% endif %}
    {% endfor %}
  </div>

  <style>
    .upsell-checkboxes {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .upsell-checkbox {
      padding: 1rem;
      background: var(--color-background-alt, #f9f9f9);
      border: 1px solid var(--color-border, #e5e5e5);
      border-radius: 0.5rem;
      transition: border-color 0.2s ease, background 0.2s ease;
    }

    .upsell-checkbox:has(.upsell-checkbox__input:checked) {
      border-color: var(--color-primary, #d4a574);
      background: rgba(212, 165, 116, 0.05);
    }

    .upsell-checkbox__label {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      cursor: pointer;
      user-select: none;
    }

    .upsell-checkbox__input {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }

    .upsell-checkbox__checkmark {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      width: 1.375rem;
      height: 1.375rem;
      background: var(--color-background, #fff);
      border: 2px solid var(--color-border, #e5e5e5);
      border-radius: 0.25rem;
      transition: background 0.2s ease, border-color 0.2s ease;
    }

    .upsell-checkbox__checkmark svg {
      opacity: 0;
      color: white;
      transition: opacity 0.2s ease;
    }

    .upsell-checkbox__input:checked + .upsell-checkbox__checkmark {
      background: var(--color-primary, #d4a574);
      border-color: var(--color-primary, #d4a574);
    }

    .upsell-checkbox__input:checked + .upsell-checkbox__checkmark svg {
      opacity: 1;
    }

    .upsell-checkbox__input:focus + .upsell-checkbox__checkmark {
      box-shadow: 0 0 0 2px rgba(212, 165, 116, 0.3);
    }

    .upsell-checkbox__content {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex: 1;
    }

    .upsell-checkbox__image {
      flex-shrink: 0;
      width: 50px;
      height: 50px;
      border-radius: 0.375rem;
      overflow: hidden;
      background: var(--color-background, #fff);
      border: 1px solid var(--color-border, #e5e5e5);
    }

    .upsell-checkbox__image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .upsell-checkbox__text {
      display: flex;
      flex-direction: column;
      gap: 0.125rem;
    }

    @media (min-width: 480px) {
      .upsell-checkbox__text {
        flex-direction: row;
        align-items: baseline;
        gap: 0.5rem;
        flex-wrap: wrap;
      }
    }

    .upsell-checkbox__title {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--color-text, #1a1a1a);
      line-height: 1.3;
    }

    .upsell-checkbox__price {
      font-size: 0.8125rem;
      font-weight: 600;
      color: var(--color-primary, #d4a574);
    }
  </style>
{% endif %}
