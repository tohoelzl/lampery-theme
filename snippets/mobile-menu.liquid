{% comment %}
  Mobile Menu Snippet - Converted from WooCommerce header.php Mobile Menu
  Usage: {% render 'mobile-menu', menu: section.settings.menu %}
{% endcomment %}

{%- liquid
  if menu != blank
    assign mobile_menu = linklists[menu]
  else
    assign mobile_menu = linklists['main-menu']
  endif
-%}

<div
  x-show="mobileMenuOpen"
  x-cloak
  class="fixed inset-0 z-50 lg:hidden"
  role="dialog"
  aria-modal="true"
  id="mobile-menu"
>
  {% comment %} Backdrop {% endcomment %}
  <div
    class="fixed inset-0 bg-text/20 backdrop-blur-sm"
    x-show="mobileMenuOpen"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition ease-in duration-200"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    @click="mobileMenuOpen = false"
  ></div>

  {% comment %} Menu Panel {% endcomment %}
  <div
    class="fixed inset-y-0 left-0 w-full max-w-sm bg-background shadow-lg flex flex-col"
    x-show="mobileMenuOpen"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="-translate-x-full"
    x-transition:enter-end="translate-x-0"
    x-transition:leave="transition ease-in duration-200"
    x-transition:leave-start="translate-x-0"
    x-transition:leave-end="-translate-x-full"
  >
    {% comment %} Menu Header {% endcomment %}
    <div class="flex items-center justify-between px-6 py-4 border-b border-border">
      <span class="text-lg font-semibold">{{ 'navigation.menu' | t }}</span>
      <button
        class="p-2 -mr-2 text-text hover:text-primary transition-colors"
        @click="mobileMenuOpen = false"
        aria-label="{{ 'accessibility.close' | t }}"
      >
        {% render 'icon-close', class: 'w-6 h-6' %}
      </button>
    </div>

    {% comment %} Menu Content {% endcomment %}
    <nav class="flex-1 overflow-y-auto px-6 py-6">
      <ul class="space-y-4">
        {% for link in mobile_menu.links %}
          <li>
            {% if link.links.size > 0 %}
              <div x-data="{ open: false }">
                <button
                  @click="open = !open"
                  class="flex items-center justify-between w-full py-2 text-lg text-text hover:text-primary transition-colors"
                >
                  <span>{{ link.title }}</span>
                  <span :class="{ 'rotate-180': open }" class="transition-transform duration-200">
                    {% render 'icon-chevron-down', class: 'w-5 h-5' %}
                  </span>
                </button>
                <ul
                  x-show="open"
                  x-collapse
                  class="pl-4 space-y-2 mt-2"
                >
                  {% for child_link in link.links %}
                    <li>
                      <a
                        href="{{ child_link.url }}"
                        class="block py-1 text-text-muted hover:text-primary transition-colors"
                        @click="mobileMenuOpen = false"
                      >
                        {{ child_link.title }}
                      </a>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            {% else %}
              <a
                href="{{ link.url }}"
                class="block py-2 text-lg text-text hover:text-primary transition-colors"
                @click="mobileMenuOpen = false"
              >
                {{ link.title }}
              </a>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    </nav>

    {% comment %} Menu Footer {% endcomment %}
    <div class="px-6 py-6 border-t border-border space-y-4">
      <a
        href="{{ routes.account_url | default: routes.account_login_url }}"
        class="flex items-center space-x-3 text-text hover:text-primary transition-colors"
        @click="mobileMenuOpen = false"
      >
        {% render 'icon-user', class: 'w-5 h-5' %}
        <span>{{ 'customer.account.title' | t }}</span>
      </a>

      {% comment %} Language Switcher (if applicable) {% endcomment %}
      {% if localization.available_languages.size > 1 %}
        <div class="pt-4 border-t border-border">
          <span class="block text-sm text-text-muted mb-2">{{ 'localization.language' | t }}</span>
          <div class="flex items-center gap-2">
            {% for language in localization.available_languages %}
              <a
                href="{{ language.root_url }}"
                class="flex-1 text-center py-2 px-3 rounded-lg text-sm font-medium transition-colors {% if language.iso_code == localization.language.iso_code %}bg-primary text-white{% else %}bg-background-alt text-text hover:bg-border{% endif %}"
              >
                {{ language.endonym_name }}
              </a>
            {% endfor %}
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</div>
