{% comment %}
  ============================================
  SLIDESHOW / HERO SECTION
  ============================================
  CRO: First impression, key messaging
  Performance: Lazy load non-first slides
  ============================================
{% endcomment %}

<section class="slideshow"
         x-data="{ currentSlide: 0, totalSlides: {{ section.blocks.size }} }"
         x-init="setInterval(() => { currentSlide = (currentSlide + 1) % totalSlides }, 5000)">
  <div class="slideshow__container">
    {%- for block in section.blocks -%}
      <div class="slideshow__slide{% if forloop.first %} is-active{% endif %}"
           x-show="currentSlide === {{ forloop.index0 }}"
           x-transition:enter="transition ease-out duration-500"
           x-transition:enter-start="opacity-0"
           x-transition:enter-end="opacity-100"
           x-transition:leave="transition ease-in duration-300"
           x-transition:leave-start="opacity-100"
           x-transition:leave-end="opacity-0"
           {{ block.shopify_attributes }}>

        <!-- Background Image -->
        {%- if block.settings.image != blank -%}
          <img class="slideshow__image"
               src="{{ block.settings.image | image_url: width: 1920 }}"
               srcset="{{ block.settings.image | image_url: width: 800 }} 800w,
                       {{ block.settings.image | image_url: width: 1200 }} 1200w,
                       {{ block.settings.image | image_url: width: 1920 }} 1920w"
               sizes="100vw"
               alt="{{ block.settings.image.alt | default: block.settings.heading | escape }}"
               loading="{% if forloop.first %}eager{% else %}lazy{% endif %}">
        {%- else -%}
          <div class="slideshow__placeholder" style="background-color: var(--color-secondary);"></div>
        {%- endif -%}

        <!-- Overlay -->
        <div class="slideshow__overlay"></div>

        <!-- Content -->
        <div class="slideshow__content container">
          {%- if block.settings.subheading != blank -%}
            <p class="slideshow__subheading">{{ block.settings.subheading }}</p>
          {%- endif -%}

          {%- if block.settings.heading != blank -%}
            <h2 class="slideshow__heading">{{ block.settings.heading }}</h2>
          {%- endif -%}

          {%- if block.settings.button_label != blank -%}
            <a href="{{ block.settings.button_link | default: '#' }}" class="btn-primary btn-lg">
              {{ block.settings.button_label }}
            </a>
          {%- endif -%}
        </div>
      </div>
    {%- endfor -%}

    <!-- Navigation Dots -->
    {%- if section.blocks.size > 1 -%}
      <div class="slideshow__dots">
        {%- for block in section.blocks -%}
          <button class="slideshow__dot"
                  :class="{ 'is-active': currentSlide === {{ forloop.index0 }} }"
                  x-on:click="currentSlide = {{ forloop.index0 }}"
                  aria-label="Go to slide {{ forloop.index }}">
          </button>
        {%- endfor -%}
      </div>

      <!-- Arrow Navigation -->
      <button class="slideshow__arrow slideshow__arrow--prev"
              x-on:click="currentSlide = (currentSlide - 1 + totalSlides) % totalSlides"
              aria-label="{{ 'accessibility.previous' | t }}">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>
      <button class="slideshow__arrow slideshow__arrow--next"
              x-on:click="currentSlide = (currentSlide + 1) % totalSlides"
              aria-label="{{ 'accessibility.next' | t }}">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    {%- endif -%}
  </div>
</section>

<style>
  .slideshow {
    position: relative;
    overflow: hidden;
  }

  .slideshow__container {
    position: relative;
    min-height: 60vh;
  }

  @media (min-width: 768px) {
    .slideshow__container {
      min-height: 70vh;
    }
  }

  .slideshow__slide {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .slideshow__slide.is-active {
    position: relative;
  }

  .slideshow__image,
  .slideshow__placeholder {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .slideshow__overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(to bottom, rgba(0,0,0,0.2), rgba(0,0,0,0.4));
  }

  .slideshow__content {
    position: relative;
    z-index: 1;
    text-align: center;
    color: #fff;
    padding: var(--spacing-xl);
  }

  .slideshow__subheading {
    font-size: var(--font-size-small);
    text-transform: uppercase;
    letter-spacing: 0.2em;
    margin-bottom: var(--spacing-sm);
    opacity: 0.9;
  }

  .slideshow__heading {
    font-size: clamp(2rem, 6vw, 4rem);
    font-weight: 700;
    margin-bottom: var(--spacing-lg);
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }

  .slideshow__button {
    margin-top: var(--spacing-md);
  }

  /* Dots */
  .slideshow__dots {
    position: absolute;
    bottom: var(--spacing-lg);
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: var(--spacing-sm);
    z-index: 2;
  }

  .slideshow__dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background-color: rgba(255,255,255,0.5);
    transition: all var(--transition-fast);
  }

  .slideshow__dot.is-active,
  .slideshow__dot:hover {
    background-color: #fff;
    transform: scale(1.2);
  }

  /* Arrows */
  .slideshow__arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 2;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(255,255,255,0.2);
    color: #fff;
    border-radius: 50%;
    transition: all var(--transition-fast);
  }

  .slideshow__arrow:hover {
    background-color: rgba(255,255,255,0.4);
  }

  .slideshow__arrow--prev {
    left: var(--spacing-md);
  }

  .slideshow__arrow--next {
    right: var(--spacing-md);
  }

  @media (max-width: 768px) {
    .slideshow__arrow {
      display: none;
    }
  }
</style>

{% schema %}
{
  "name": "Slideshow",
  "tag": "div",
  "class": "slideshow-section",
  "max_blocks": 5,
  "settings": [],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Background image"
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "Subheading",
          "default": "New Collection"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Welcome to Lampery"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Button label",
          "default": "Shop Now"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Slideshow",
      "blocks": [
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}
