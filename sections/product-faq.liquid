{% comment %}
  Product FAQ Section
  Features: Accordion FAQ for product pages, JSON-LD Schema for Google Rich Snippets
{% endcomment %}

{% if section.blocks.size > 0 %}
<section class="product-faq">
  <div class="product-faq__container">

    {% if section.settings.title != blank %}
      <h2 class="product-faq__title">{{ section.settings.title }}</h2>
    {% endif %}

    <div class="product-faq__list" x-data="{ openItem: {% if section.settings.first_open %}1{% else %}0{% endif %} }">
      {% for block in section.blocks %}
        {% if block.type == 'faq_item' %}
          <div class="product-faq__item" {{ block.shopify_attributes }}>
            <button
              type="button"
              class="product-faq__question"
              :class="{ 'is-open': openItem === {{ forloop.index }} }"
              @click="openItem = openItem === {{ forloop.index }} ? 0 : {{ forloop.index }}"
              aria-expanded="false"
              :aria-expanded="openItem === {{ forloop.index }}"
            >
              <span class="product-faq__question-text">{{ block.settings.question }}</span>
              <span class="product-faq__icon">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" :class="{ 'rotate-180': openItem === {{ forloop.index }} }">
                  <path d="M5 7.5L10 12.5L15 7.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
            </button>
            <div
              class="product-faq__answer"
              x-show="openItem === {{ forloop.index }}"
              x-collapse
              x-cloak
            >
              <div class="product-faq__answer-content">
                {{ block.settings.answer }}
              </div>
            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>

  </div>
</section>

{% comment %} JSON-LD FAQ Schema for Google Rich Snippets {% endcomment %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {%- for block in section.blocks -%}
      {%- if block.type == 'faq_item' and block.settings.question != blank and block.settings.answer != blank -%}
        {
          "@type": "Question",
          "name": {{ block.settings.question | json }},
          "acceptedAnswer": {
            "@type": "Answer",
            "text": {{ block.settings.answer | strip_html | json }}
          }
        }{% unless forloop.last %},{% endunless %}
      {%- endif -%}
    {%- endfor -%}
  ]
}
</script>
{% endif %}

<style>
  .product-faq {
    padding: 2.5rem 0;
    border-top: 1px solid var(--color-border);
  }

  @media (min-width: 1024px) {
    .product-faq {
      padding: 3rem 0;
    }
  }

  .product-faq__container {
    max-width: 100%;
  }

  /* Header */
  .product-faq__title {
    font-family: var(--font-heading-family);
    font-size: 1.25rem;
    font-weight: 600;
    margin: 0 0 1.5rem;
    color: var(--color-text);
  }

  @media (min-width: 1024px) {
    .product-faq__title {
      font-size: 1.5rem;
    }
  }

  /* FAQ List */
  .product-faq__list {
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  /* FAQ Item */
  .product-faq__item {
    border-bottom: 1px solid var(--color-border);
  }

  .product-faq__item:first-child {
    border-top: 1px solid var(--color-border);
  }

  /* Question Button */
  .product-faq__question {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    width: 100%;
    padding: 1rem 0;
    background: none;
    border: none;
    cursor: pointer;
    text-align: left;
    font-family: inherit;
    font-size: 0.9375rem;
    font-weight: 500;
    color: var(--color-text);
    transition: color 0.2s ease;
  }

  @media (min-width: 1024px) {
    .product-faq__question {
      padding: 1.25rem 0;
      font-size: 1rem;
    }
  }

  .product-faq__question:hover {
    color: var(--color-primary);
  }

  .product-faq__question.is-open {
    color: var(--color-primary);
  }

  .product-faq__question-text {
    flex: 1;
  }

  /* Icon */
  .product-faq__icon {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-text-muted);
    transition: color 0.2s ease;
  }

  .product-faq__question:hover .product-faq__icon,
  .product-faq__question.is-open .product-faq__icon {
    color: var(--color-primary);
  }

  .product-faq__icon svg {
    transition: transform 0.3s ease;
  }

  .product-faq__icon svg.rotate-180 {
    transform: rotate(180deg);
  }

  /* Answer */
  .product-faq__answer {
    overflow: hidden;
  }

  .product-faq__answer-content {
    padding: 0 0 1.25rem;
    font-size: 0.875rem;
    line-height: 1.7;
    color: var(--color-text-muted);
  }

  @media (min-width: 1024px) {
    .product-faq__answer-content {
      font-size: 0.9375rem;
      padding-right: 2rem;
    }
  }

  .product-faq__answer-content p {
    margin: 0 0 0.75rem;
  }

  .product-faq__answer-content p:last-child {
    margin-bottom: 0;
  }

  .product-faq__answer-content ul,
  .product-faq__answer-content ol {
    margin: 0 0 0.75rem;
    padding-left: 1.25rem;
  }

  .product-faq__answer-content li {
    margin-bottom: 0.375rem;
  }

  .product-faq__answer-content a {
    color: var(--color-primary);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .product-faq__answer-content a:hover {
    text-decoration: none;
  }

  /* x-cloak for Alpine.js */
  [x-cloak] {
    display: none !important;
  }
</style>

{% schema %}
{
  "name": "Produkt FAQ",
  "class": "section-product-faq",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Titel",
      "default": "Häufig gestellte Fragen"
    },
    {
      "type": "checkbox",
      "id": "first_open",
      "label": "Erste Frage standardmäßig öffnen",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "faq_item",
      "name": "FAQ Eintrag",
      "settings": [
        {
          "type": "text",
          "id": "question",
          "label": "Frage",
          "default": "Was ist die Frage?"
        },
        {
          "type": "richtext",
          "id": "answer",
          "label": "Antwort",
          "default": "<p>Hier kommt die Antwort auf die Frage.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Produkt FAQ",
      "blocks": [
        {
          "type": "faq_item",
          "settings": {
            "question": "Welche Leuchtmittel werden empfohlen?",
            "answer": "<p>Wir empfehlen LED-Leuchtmittel mit warmweißer Lichtfarbe (2700-3000K) für ein gemütliches Ambiente. Die maximale Wattzahl und Fassung finden Sie in den Produktdetails.</p>"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "Ist die Montage kompliziert?",
            "answer": "<p>Alle unsere Lampen werden mit einer detaillierten Montageanleitung geliefert. Für elektrische Installationen empfehlen wir einen Fachmann zu beauftragen.</p>"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "Wie pflege ich die Lampe?",
            "answer": "<p>Reinigen Sie die Lampe regelmäßig mit einem trockenen, weichen Tuch. Vermeiden Sie aggressive Reinigungsmittel. Bei Stoffschirmen kann ein Staubsauger auf niedrigster Stufe verwendet werden.</p>"
          }
        }
      ]
    }
  ],
  "templates": ["product"]
}
{% endschema %}
